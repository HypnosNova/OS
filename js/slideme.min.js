/*!
 * SlideMe v1.0.0
 * Docs & License: Matteo Martinelli
 * (c) 2013 Matteo Martinelli
 */
(function(e) {
	var f = {
		drag: false,
		autodrag: false, //false
		refreshAgo: true,
		previous: [0, 0],
		limitsStart: 1,
		topStart: 0,
		speed: [500, 600],
		isUp: true
	};
	e.fn.SlideMe = function(h) {
		e.extend(f, h);
		this.each(function(l, j) {
			var k = e(j);
			var m = new c(k);
			m.render()
		});
		return this
	};
	var c = function(m) {
		var x = this;
		var u = e(window);
		x.render = i;
		var q;
		var j;
		mouseMoveEvent = function(t) {
			if (f.drag) {
				if (f.isUp) {
					f.isUp = false;
					f.drag = false;
					m.animate({
						top: u.height() - m.height()
					}, f.speed[1], function() {
						m.children(".label").removeClass("mousedown");
						f.autodrag = true; //false
					})
					return;
				} else {
					f.isUp = true;
					f.drag = false;
					m.animate({
						top: -u.height() + 20
					}, f.speed[1], function() {
						m.children(".label").removeClass("mousedown");
						f.autodrag = true; //false
					})
					return;
				}

			}
		};
		mouseUpEvent = function() {
		};
		mouseDownEvent = function() {
			f.drag = true;
			f.topStart = m.position().top;
			q.addClass("mousedown")
		};
		resizeEvent = function() {
			m.children(".container").css({
				height: u.innerHeight() - 20
			});
			if (m.position().top == 0) {
				m.css({
					height: u.innerHeight(),
					width: u.innerWidth()
				})
			} else {
				m.css({
					height: u.innerHeight(),
					width: u.innerWidth(),
					top: -(u.innerHeight() - 20)
				})
			}
		};

		function i() {
			o();
			l();
			q = m.children(".label");
			k();
		}

		function k() {
			e(document).mousemove(mouseMoveEvent).mouseup(mouseUpEvent);
			u.resize(resizeEvent);
			q.mousedown(mouseDownEvent).hover(function() {
				if (!f.autodrag && !f.drag) {
					q.addClass("mousedown")
				}
			}, function() {
				if (!f.autodrag && !f.drag) {
					q.removeClass("mousedown")
				}
			})
		}


		function o() {
			m.append('<div class="label"></div>')
		}

		function l() {
			m.append('<div class="container"><section id="homeScreen" style="position: fixed;"><div id="mask"><div id="allScreens"></div></div><ul id="indicators"></ul></section></div>');
			m.css({
				width: u.innerWidth(),
				height: u.innerHeight(),
				top: -(u.innerHeight() - 20)
			});
			m.children(".container").css({
				height: m.height() - 20
			})
		}

	};

})(jQuery);